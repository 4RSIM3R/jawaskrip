<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: parser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: parser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author indmind &lt;mail.indmind@gmail.com>
 * @file parsing process
 * @version 0.0.2
 * 
 */

const beautify = require('js-beautify').js_beautify;
const {
    constant
} = require("./var");

let addition = {};

exports.parse = (_tokens, _callback) => {

    const token_handler = {
        ULANGI: ulangi_handler,
        SETIAP: setiap_handler
    };
    token_handler[constant.T_INPUT] = masukan_handler;

    let resultJS = ``;
    let keyProcessed = 0;
    _tokens.forEach(_token => {
        // cek jika ada fungsi untuk handel token
        if (Object.keys(token_handler).includes(_token.type.toString())) {
            resultJS += token_handler[_token.type](_token);
        } else {
            resultJS += _token.value + " ";
        }
        keyProcessed++;
        if (keyProcessed == _tokens.length) {
            let allResult = "";
            let allProcessed = 0;
            if (Object.keys(addition).length &lt;= 0) _callback(resultJS);
            Object.keys(addition).forEach(a => {
                allResult += addition[a];
                allProcessed++;
                if (allProcessed == Object.keys(addition).length)
                    _callback(allResult + resultJS);
            });
        }
    });
};

// addition string

const RANGE = `function range(len){
    return [...Array(len).keys()];
}`;
const INPUT = `const readlineSync = require('readline-sync');`

// handler untuk fungsi kustom

/**
 * transform ulangi menjadi for loop
 * @param {Object} token 
 * jika input ulangi(var i sebanyak 10 kali);
 * result harus for(var i in range(10));
 * dan sudah terdapat fungsi range();
 */
function ulangi_handler(token) {
    let valArr = beautify(token.value, {
        indent_level: 4
    }).split(" ");
    if (valArr.length &lt; 5) {
        triggerError("Syntax 'ulangi' error", token.line);
        process.exit();
    }

    addition.range = RANGE;

    var parsedJS = `for(${valArr[0].split('(')[1]} ${valArr[1]} in range(${valArr[3]}))`;
    return parsedJS;
}


/**
 * transform setiap menjadi forEach
 * @param {Object} token 
 */
function setiap_handler(token) {
    const val = beautify(token.value, {
        indent_level: 4
    }).split(" ");
    return parsedJS = `for(var ${val[2].slice(0, -1)} of ${val[0].split("(")[1]})`;
}

function masukan_handler(token) {
    addition.input = INPUT;
    return token.value;
}

function createAddition(id, data) {
    return {
        id: id,
        data: data
    };
}

function triggerError(mess, line) {
    throw `Error pada baris ${line}: "${mess}"`;
}


// exec function by name
/**
 * @tutorial https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string
 */
function executeFunctionByName(functionName, context /*, args */ ) {
    var args = Array.prototype.slice.call(arguments, 2);
    var namespaces = functionName.split(".");
    var func = namespaces.pop();
    for (var i = 0; i &lt; namespaces.length; i++) {
        context = context[namespaces[i]];
    }
    return context[func].apply(context, args);
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Tokenizer.html">Tokenizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#c">c</a></li><li><a href="global.html#executeFunctionByName">executeFunctionByName</a></li><li><a href="global.html#filter">filter</a></li><li><a href="global.html#line">line</a></li><li><a href="global.html#setiap_handler">setiap_handler</a></li><li><a href="global.html#ulangi_handler">ulangi_handler</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Dec 10 2017 19:56:19 GMT+0700 (WIB)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
