<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: program.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: program.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author indmind &lt;mail.indmind@gmail.com>
 * @file proses compiling
 * @version 0.0.2
 */

const tokenizer = require("./tokenizer");
const parser = require("./parser");
const fs = require("fs");
const childProcess = require('child_process');
const path = require("path");
const beautify = require('js-beautify').js_beautify;

const tempDir = "/../../temp/";

exports.compile = (_filepath, _callback) => {
    tokenizer.lex(_filepath, (_token) => {
        parser.parse(_token, (parsed) => {
            _callback(beautify(parsed, {indent_size: 4}));
        });
    });
};

exports.token = (_filepath, _callback) => {
    tokenizer.lex(_filepath, (_token) => {
        _callback(_token);
    });
};

exports.clean = _callback => {
    let fileRemoved = 0;
    fs.readdir(path.join(__dirname, tempDir), (err, files) => {
        if(err) throw err;
        if(files.length &lt;= 0) _callback("No file on temp directory");
        files.forEach((_file) => {
	    if(_file == "temp") return;
            fs.unlink(path.join(__dirname, tempDir, _file), _err => {
                if(_err) throw _err;
                fileRemoved++;
            });
            if(fileRemoved == files.length) _callback("All file cleaned");
        });
    });
};

exports.run = (parsed, callback) => {
    const tempFile = path.join(__dirname, tempDir, generateName());
    fs.writeFile(tempFile, beautify(parsed, {indent_size: 4}), (err) => {
        if(err) throw err;
        runScript(tempFile, code => {
            try{
                if(code) throw code;
            }finally{
                this.clean();
                callback();
            }
        });
    });
};

function runScript(_scriptPath, _callback){
    let invoked = false;
    let process = childProcess.fork(_scriptPath);

    process.on('exit', code => {
        if(invoked) return;
        invoked = true;
        let err = code == 0 ? null : new Error("exit code " + code);
        _callback(err);
    });
}

function generateName(_length = 10){
    let text = '';
    let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890";
    for(let i = 0;i &lt; _length;i++) text += possible.charAt(Math.floor(Math.random() * possible.length));
    return text;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Tokenizer.html">Tokenizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#c">c</a></li><li><a href="global.html#executeFunctionByName">executeFunctionByName</a></li><li><a href="global.html#filter">filter</a></li><li><a href="global.html#line">line</a></li><li><a href="global.html#setiap_handler">setiap_handler</a></li><li><a href="global.html#ulangi_handler">ulangi_handler</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Dec 10 2017 19:56:19 GMT+0700 (WIB)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
